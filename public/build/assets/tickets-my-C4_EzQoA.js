document.addEventListener("DOMContentLoaded",function(){m()});function m(){console.log("ðŸŽ« Inicializando funcionalidad de Mis Tickets"),u(),g(),k()}function u(){let e=document.getElementById("imageModal");e||(e=f()),document.addEventListener("keydown",function(c){c.key==="Escape"&&e&&!e.classList.contains("hidden")&&closeImageModal()}),e&&e.addEventListener("click",function(c){c.target===e&&closeImageModal()})}function f(){const e=document.createElement("div");return e.id="imageModal",e.className="fixed inset-0 z-50 hidden items-center justify-center bg-black/80 backdrop-blur-sm p-4",e.innerHTML=`
        <div class="relative max-w-[95vw] max-h-[95vh] flex items-center justify-center">
            <button onclick="closeImageModal()" 
                    class="absolute -top-4 -right-4 z-10 h-10 w-10 rounded-full bg-white/90 text-gray-800 shadow-lg hover:bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all">
                <svg class="h-6 w-6 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
            <img id="modalImage" src="" alt="" 
                 class="max-w-[90vw] max-h-[85vh] object-contain rounded-lg shadow-2xl bg-white">
            <div class="absolute bottom-0 left-0 right-0 bg-black/50 text-white p-3 rounded-b-lg">
                <p id="modalImageName" class="text-sm font-medium text-center"></p>
            </div>
        </div>
    `,document.body.appendChild(e),e}window.expandImage=function(e){const c=document.getElementById("imageModal"),t=document.getElementById("modalImage"),d=document.getElementById("modalImageName");c&&t&&(t.src=e.src,t.alt=e.alt,d&&(d.textContent=e.alt||"Imagen del ticket"),c.classList.remove("hidden"),c.classList.add("flex"))};window.closeImageModal=function(){const e=document.getElementById("imageModal");e&&(e.classList.add("hidden"),e.classList.remove("flex"))};function g(){const e=document.getElementById("cancelModal"),c=document.getElementById("cancelModalClose"),t=document.getElementById("cancelModalConfirm"),d=document.getElementById("cancelModalMessage");let a=null,o=null;document.addEventListener("click",function(i){const l=i.target.closest("[data-cancel-ticket]");l&&(i.preventDefault(),a=l.dataset.ticketId,o=l.dataset.ticketFolio,d&&(d.textContent=`Â¿EstÃ¡s seguro que deseas cancelar el ticket ${o}? Esta acciÃ³n no se puede deshacer.`),e&&(e.classList.remove("hidden"),e.classList.add("flex")))}),c&&c.addEventListener("click",n),t&&t.addEventListener("click",function(){a&&r(a)}),e&&(document.addEventListener("keydown",function(i){i.key==="Escape"&&!e.classList.contains("hidden")&&n()}),e.addEventListener("click",function(i){i.target===e&&n()}));function n(){e&&(e.classList.add("hidden"),e.classList.remove("flex")),a=null,o=null}async function r(i){try{if(t&&(t.disabled=!0,t.textContent="Cancelando..."),(await fetch(`/ticket/${i}`,{method:"DELETE",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""}})).ok)n(),s("Ticket cancelado exitosamente","success"),setTimeout(()=>{window.location.reload()},1500);else throw new Error("Error al cancelar el ticket")}catch(l){console.error("Error:",l),s("Error al cancelar el ticket. IntÃ©ntalo de nuevo.","error")}finally{t&&(t.disabled=!1,t.textContent="Aceptar")}}}function k(){document.addEventListener("click",function(a){const o=a.target.closest("[data-acknowledge-update]");if(o){a.preventDefault();const n=o.dataset.ticketId;n&&c(n,o)}});const e=document.querySelector("[data-acknowledge-all]");e&&e.addEventListener("click",function(a){a.preventDefault(),t(this)});async function c(a,o){try{const n=o.textContent;if(o.disabled=!0,o.textContent="Marcando...",(await fetch(`/ticket/${a}/acknowledge-update`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""}})).ok){const i=o.closest("[data-ticket-card]");if(i){const l=i.querySelector("[data-update-indicator]");l&&l.remove()}o.remove(),s("ActualizaciÃ³n marcada como revisada","success"),d()}else throw new Error("Error al marcar como revisado")}catch(n){console.error("Error:",n),s("Error al marcar como revisado","error"),o.disabled=!1,o.textContent=originalText}}async function t(a){try{const o=a.textContent;if(a.disabled=!0,a.textContent="Marcando todos...",(await fetch("/tickets/acknowledge-all",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""}})).ok)s("Todas las actualizaciones marcadas como revisadas","success"),setTimeout(()=>{window.location.reload()},1500);else throw new Error("Error al marcar todos como revisados")}catch(o){console.error("Error:",o),s("Error al marcar todos como revisados","error"),a.disabled=!1,a.textContent=originalText}}function d(){const o=document.querySelectorAll("[data-update-indicator]").length,n=document.querySelector("[data-notification-count]");n&&(o>0?(n.textContent=o,n.classList.remove("hidden")):n.classList.add("hidden"))}}function s(e,c="info"){const t=document.createElement("div"),d=c==="success"?"bg-green-500":c==="error"?"bg-red-500":"bg-blue-500";t.className=`fixed top-4 right-4 ${d} text-white px-6 py-3 rounded-lg shadow-lg z-50 transform transition-all duration-300 translate-x-full opacity-0`,t.textContent=e,document.body.appendChild(t),setTimeout(()=>{t.classList.remove("translate-x-full","opacity-0")},100),setTimeout(()=>{t.classList.add("translate-x-full","opacity-0"),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t)},300)},4e3)}window.initializeMyTickets=m;window.expandImage=expandImage;window.closeImageModal=closeImageModal;window.showNotification=s;console.log("âœ… Tickets-my.js cargado correctamente");
